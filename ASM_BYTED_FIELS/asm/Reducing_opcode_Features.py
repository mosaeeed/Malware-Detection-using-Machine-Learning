"""In this part, we reduce the number of opcodes whose overall frequencies are less than 500 
    for reducing the size of CSV
"""

# Import Libraries
import numpy as np
import pandas as pd
import csv

# Reading values from data_opcode. As its size is too large, it is read in the chunk of 1000 and concatenate at the end
size=1000
b=pd.read_csv('data_opcode.csv',chunksize=size)
data_list=[]
for i in b:
    data_list.append(i)
data_pd = pd.DataFrame()
for chunk in data_list:
    data_pd = pd.concat([data_pd,chunk])
data_arr=data_pd.values

# In this section indexes of opcode fields extracted whose overall frequencies are less than 500
x=data_arr[:,0:-2]
x=np.sum(x,axis=0)
index_list=[]
opcode_freq=500
for i,j in enumerate(x):
    if j>=opcode_freq:
        index_list.append(i)
        
# In this section row for field name of CSV is created by eliminating the less frequent opcodes
data_to_list=[]
names=[]
for i,j in enumerate(data_pd):
    if i in index_list:
        names.append(j)
names.append('ID')
names.append('LABELS')
data_to_list.append(names)


# Here data(selected opcodes) of samples copied to data_to_list along with their names and labels
for i in data_arr:
    temp=[]
    for j in index_list:
        temp.append(i[j])
            
    temp.append(i[-2])
    temp.append(i[-1])
    data_to_list.append(temp)
    
# Saving new data to CSV
myFile = open('500_reduce_opcode.csv', 'w', newline='')  
with myFile:  
    writer = csv.writer(myFile)
    writer.writerows(data_to_list)