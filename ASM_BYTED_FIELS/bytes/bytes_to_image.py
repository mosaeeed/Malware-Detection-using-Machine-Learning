# Import Libraries
from PIL import Image
import numpy as np

# Fixied Width For Image
width = 1366

# Reading the data (names and labels) from csv
malwarelist=np.genfromtxt('trainLabels.csv',delimiter=",",dtype=str)
malwarelist=malwarelist[1:]

# Giving a path where to store images and from where to pick byte files 
destination='/home/mohamed/Documents/GP/Dynamic_Detection/datasets/bytes_image/'
folder='/home/mohamed/Documents/GP/Dynamic_Detection/datasets/bytes/'


# Converting File To Image
corrupted_files=[]
for name in malwarelist:
    b = ".bytes"
    nam=name[0].strip('"')
    loc = folder+nam+b
    hexar = []
    with open(loc, 'rb') as f: 
        for line in f:
            hexar.extend(int(el, 16) for el in line.split()[1:] if el != b'??')
    print(len(hexar)) 
    if len(hexar)!=0:
        rn = len(hexar) // width
        fh = np.reshape(hexar[:rn * width], (-1, width))
        fh=  np.uint8(fh)
        print(nam,'  ',fh.shape)
        img = Image.fromarray(fh)
        img.save(destination+nam+".png")
        print("Finised {} ".format(name) )
    if len(hexar)==0:
        corrupted_files.append(nam)